services:
  - type: web
    name: spana-backend
    env: node
    plan: free
    buildCommand: npm install && npm run build
    startCommand: node dist/server.js
    # IMPORTANT: Make sure buildCommand runs BEFORE startCommand
    # Build compiles TypeScript to dist/ folder
    envVars:
      - key: NODE_ENV
        value: production
      # Use Internal Database URL for Render services (faster, no SSL needed)
      - key: DATABASE_URL
        value: postgresql://spana_users:U2kOB5yHZDB5vI9tuEfPqLB2t52Ai3SH@dpg-d3p2ooc9c44c738ksb8g-a/spana_db
      # For local development, use External URL: postgresql://spana_users:U2kOB5yHZDB5vI9tuEfPqLB2t52Ai3SH@dpg-d3p2ooc9c44c738ksb8g-a.frankfurt-postgres.render.com/spana_db?sslmode=require
      - key: POSTGRES_SSL
        value: "false"
      - key: JWT_SECRET
        generateValue: true
      - key: CLIENT_URL
        value: https://your-frontend-domain.com
      - key: NODE_OPTIONS
        value: --max-old-space-size=4096
